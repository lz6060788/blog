## 新增需求

### 需求：OAuth 登录支持
系统应支持通过 GitHub 和 Google OAuth 提供商进行用户认证。

#### 场景：通过 GitHub 登录
- **当** 用户点击"使用 GitHub 登录"按钮
- **则** 系统重定向到 GitHub OAuth 授权页面
- **且** 用户授权后系统创建用户账户（如果不存在）
- **且** 用户被重定向回应用并已登录

#### 场景：通过 Google 登录
- **当** 用户点击"使用 Google 登录"按钮
- **则** 系统重定向到 Google OAuth 授权页面
- **且** 用户授权后系统创建用户账户（如果不存在）
- **且** 用户被重定向回应用并已登录

### 需求：认证 API 端点
系统应在 `/api/auth/[...nextauth]` 路由提供 NextAuth.js 处理程序。

#### 场景：访问认证端点
- **当** 客户端请求 `/api/auth/signin` 端点
- **则** 系统返回可用的登录提供商列表
- **且** 每个提供商都有对应的登录 URL

#### 场景：登出请求
- **当** 用户点击登出按钮
- **则** 系统调用 `/api/auth/signout` 端点
- **且** 会话被清除
- **且** 用户被重定向到首页

### 需求：用户数据存储
系统应使用 Drizzle ORM 在 SQLite 数据库中存储用户信息。

#### 场景：新用户首次登录
- **当** 用户通过 OAuth 首次登录
- **则** 系统在 users 表中创建新用户记录
- **且** 系统在 accounts 表中关联 OAuth 账户
- **且** 用户基本信息（姓名、邮箱、头像）从 OAuth 提供商获取

#### 场景：已有用户登录
- **当** 用户之前通过 OAuth 登录过
- **则** 系统查找现有的用户记录
- **且** 系统更新用户信息（如有变更）
- **且** 系统创建新的会话

### 需求：基于邮箱的账号自动关联
系统应在用户使用不同 OAuth 提供商但相同邮箱登录时，自动关联到同一用户账号。

#### 场景：新提供商登录到已有账号
- **当** 用户已通过 GitHub 登录（邮箱：user@example.com）
- **且** 用户使用 Google（相同邮箱 user@example.com）登录
- **则** 系统检测到邮箱已存在于数据库
- **且** 系统将 Google account 关联到现有用户
- **且** 不创建新的用户记录
- **且** 用户访问同一个账号

#### 场景：多个 OAuth 账户关联
- **当** 用户账号关联了多个 OAuth 提供商
- **则** users 表中只有一条用户记录
- **且** accounts 表中有多条记录指向同一用户 ID
- **且** 用户可以用任一关联的提供商登录

#### 场景：邮箱不一致时创建新账号
- **当** 用户使用 GitHub（邮箱 A）登录
- **且** 用户使用 Google（邮箱 B，不同）登录
- **则** 系统创建两个独立的用户账号
- **且** 邮箱不同时不会自动关联

### 需求：环境配置
系统应通过环境变量配置 OAuth 提供商凭据。

#### 场景：配置 GitHub OAuth
- **当** `GITHUB_CLIENT_ID` 和 `GITHUB_CLIENT_SECRET` 环境变量已设置
- **则** GitHub 登录功能可用
- **且** 系统使用这些凭据与 GitHub API 通信

#### 场景：配置 Google OAuth
- **当** `GOOGLE_CLIENT_ID` 和 `GOOGLE_CLIENT_SECRET` 环境变量已设置
- **则** Google 登录功能可用
- **且** 系统使用这些凭据与 Google API 通信

#### 场景：缺少凭据
- **当** OAuth 提供商的环境变量未设置
- **则** 该提供商的登录选项不显示
- **且** 系统继续正常运行（不崩溃）

### 需求：安全性配置
系统应配置 NextAuth.js 的安全设置。

#### 场景：配置密钥
- **当** `AUTH_SECRET` 环境变量已设置
- **则** 系统使用该密钥加密 JWT 和会话
- **且** 如果未设置，系统在启动时生成警告

#### 场景：生产环境 HTTPS
- **当** 应用在生产环境运行
- **则** 系统强制使用 HTTPS 进行 OAuth 回调
