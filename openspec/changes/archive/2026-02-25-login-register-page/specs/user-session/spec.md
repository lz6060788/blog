# 用户会话规范变更

## ADDED Requirements

### 需求：登录页面会话检测

登录页面应检测用户当前会话状态，已登录用户应自动重定向。

#### 场景：已登录用户访问登录页

- **当** 用户已拥有有效会话
- **且** 用户访问 `/login` 页面
- **则** 页面检测到会话状态
- **且** 系统自动将用户重定向到首页
- **且** 不显示登录表单

#### 场景：未登录用户访问登录页

- **当** 用户未登录（无会话或会话已过期）
- **且** 用户访问 `/login` 页面
- **则** 页面显示登录表单
- **且** 显示可用的 OAuth 登录选项

### 需求：登录成功后的会话建立

系统应在 OAuth 认证成功后立即建立用户会话。

#### 场景：OAuth 回调后建立会话

- **当** 用户从 OAuth 提供商页面授权后返回
- **则** 系统建立新的会话记录
- **且** 生成有效的 sessionToken
- **且** 设置明确的过期时间
- **且** 将会话信息存储到数据库

#### 场景：登录页检测到新会话

- **当** 会话建立完成后，用户被重定向回登录页
- **则** 登录页面组件通过 useSession hook 检测到会话变化
- **且** 状态从 "loading" 变为 "authenticated"
- **且** 页面触发重定向到目标页面

### 需求：登录页面会话状态展示

登录页面可根据会话状态显示不同的加载反馈。

#### 场景：会话加载状态

- **当** 用户首次访问登录页面
- **且** 系统正在验证会话状态
- **则** useSession hook 返回 status: "loading"
- **且** 页面显示加载指示器（骨架屏或 spinner）
- **且** 不显示登录表单，避免闪烁

#### 场景：会话未认证状态

- **当** 系统确认用户无有效会话
- **则** useSession hook 返回 status: "unauthenticated"
- **且** 页面显示登录表单
- **且** 移除加载指示器

#### 场景：会话已认证状态

- **当** 系统确认用户已登录
- **则** useSession hook 返回 status: "authenticated"
- **且** 页面不显示登录表单
- **且** 立即触发重定向

## MODIFIED Requirements

### 需求：客户端会话访问

原需求描述：系统应提供客户端 hooks 访问会话状态。

#### 场景：登录页面使用 useSession hook

- **当** 登录页面组件使用 `useSession()` hook
- **则** hook 返回当前会话状态（data、status）
- **且** status 可以是 "loading"、"authenticated" 或 "unauthenticated"
- **且** 登录页面根据状态渲染：
  - "loading" → 显示加载指示器
  - "unauthenticated" → 显示登录表单
  - "authenticated" → 触发重定向到目标页面

#### 场景：登录页面服务端会话访问

- **当** 登录页面（服务端组件）需要访问会话
- **则** 可以使用 `auth()` 函数获取当前会话
- **且** 如果会话存在，直接重定向到目标页面
- **且** 无需额外的 API 请求

## REMOVED Requirements

无移除的需求。
